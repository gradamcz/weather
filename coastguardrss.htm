<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <title>PGSC US Coast Guard News</title>
  <style>
    :root {
      --primary-color: #1a365d;
      --secondary-color: #2d3748;
      --accent-color: #2b6cb0;
      --text-color: #2d3748;
      --text-light: #718096;
      --text-inverse: #ffffff;
      --background: black;
      --card-bg: #ffffff;
      --border-color: #e2e8f0;
      --success-color: #38a169;
      --error-color: #e53e3e;
      --warning-color: #dd6b20;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --transition: all 0.3s ease;
      --card-bg: #f8f9fa;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: var(--background);
      color: var(--text-color);
      line-height: 1.6;
      padding: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    header {
      background: var(--secondary-color);
      color: var(--text-inverse);
      padding: 1rem 0;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }

    .logo {
      height: 60px;
      filter: brightness(0) invert(1);
    }

    h1 {
      font-family: 'Bebas Neue', Arial, sans-serif;
      font-size: clamp(1.8rem, 5vw, 3rem);
      text-transform: uppercase;
      font-weight: 500;
      letter-spacing: 1px;
      text-align: center;
      margin: 0;
      line-height: 1.1;
    }

    .subtitle {
      text-align: center;
      font-size: 1rem;
      margin-top: 0.5rem;
      opacity: 0.9;
      font-weight: 300;
    }

    .controls {
      background: var(--card-bg);
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .controls-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .last-updated {
      font-size: 0.85rem;
      color: var(--text-light);
    }

    .refresh-btn {
      background: var(--secondary-color);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Roboto', sans-serif;
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: var(--transition);
      box-shadow: 0 2px 4px rgba(43, 108, 176, 0.3);
    }

    .refresh-btn:hover {
      background: gray;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(43, 108, 176, 0.4);
    }

    .refresh-btn:active {
      transform: translateY(0);
    }

    .refresh-btn:disabled {
      background: var(--text-light);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .refresh-btn.loading {
      position: relative;
      color: transparent;
    }

    .refresh-btn.loading::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      top: 50%;
      left: 50%;
      margin: -9px 0 0 -9px;
      border: 2px solid transparent;
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .update-notice {
      padding: 0.5rem 1rem;
      border-radius: 4px;
      margin: 0.75rem 0;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 500;
      animation: slideIn 0.3s ease;
    }

    .update-notice.success {
      background: rgba(56, 161, 105, 0.1);
      border: 1px solid var(--success-color);
      color: var(--success-color);
    }

    .update-notice.error {
      background: rgba(229, 62, 62, 0.1);
      border: 1px solid var(--error-color);
      color: var(--error-color);
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .feed {
      padding: 1.5rem 0;
    }

    /* UPDATED: More compact full-width articles layout */
    .articles-list {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      max-width: 100%;
    }

    .article-compact {
      background: var(--card-bg);
      border-radius: 6px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: var(--transition);
      padding: 1.25rem;
      border-left: 4px solid var(--accent-color);
    }

    .article-compact:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px -3px rgba(0, 0, 0, 0.1);
    }

    .article-header {
      margin-bottom: 0;
    }

    .article-title {
      font-family: 'Bebas Neue', Arial, sans-serif;
      font-size: 1.5rem;
      line-height: 1.3;
      margin-bottom: 0;
      color: var(--primary-color);
    }

    .article-title a {
      color: inherit;
      text-decoration: none;
      transition: var(--transition);
    }

    .article-title a:hover {
      color: var(--accent-color);
      text-decoration: underline;
    }

    .article-date {
      font-size: 0.75rem;
      color: var(--text-light);
      font-weight: 400;
    }

    .article-description {
      color: var(--text-color);
      font-size: 0.95rem;
      line-height: 1.6;
      white-space: pre-line;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .article-description p {
      margin-bottom: 0;
    }

    .article-description p:last-child {
      margin-bottom: 0;
    }

    .article-description a {
      color: var(--accent-color);
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: var(--transition);
    }

    .article-description a:hover {
      border-bottom: 1px solid var(--accent-color);
    }

    .loading-state, .empty-state, .error-state {
      text-align: center;
      padding: 2rem 1rem;
      width: 100%;
    }

    .loading-spinner {
      display: inline-block;
      width: 30px;
      height: 30px;
      border: 3px solid rgba(43, 108, 176, 0.2);
      border-radius: 50%;
      border-top-color: var(--accent-color);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 0;
    }

    .empty-icon, .error-icon {
      font-size: 2rem;
      margin-bottom: 0;
      opacity: 0.5;
    }

    footer {
      background: var(--primary-color);
      color: var(--text-inverse);
      padding: 1.5rem 0;
      margin-top: 2rem;
    }

    .footer-content {
      text-align: center;
    }

    .footer-content p {
      margin: 0.25rem 0;
      opacity: 0.8;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        text-align: center;
      }
      
      .controls-content {
        flex-direction: column;
        align-items: stretch;
        gap: 0.75rem;
      }
      
      .last-updated {
        text-align: center;
        font-size: 0.8rem;
      }
      
      .article-compact {
        padding: 1rem;
        margin: 0 -1rem;
        border-radius: 0;
        border-left: none;
        border-bottom: 2px solid var(--border-color);
        box-shadow: none;
      }
      
      .article-title {
        font-size: 1.3rem;
      }
      
      .article-description {
        font-size: 0.9rem;
        line-height: 1.5;
      }
      
      .feed {
        padding: 1rem 0;
      }
      
      .articles-list {
        gap: 1rem;
      }
    }
	p {
    display: block;
    margin-block-start: 2px;
    margin-block-end: 2px;
    margin-inline-start: 0px;
    margin-inline-end: 0px;
    unicode-bidi: isolate;
}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <div>
          <h1>Local US Coast Guard Alerts</h1>
        </div>
      </div>
    </div>
  </header>

  <div class="controls">
    <div class="container">
      <div class="controls-content">
        <div class="last-updated" id="lastUpdated">Last updated: Loading...</div>
        <button id="refreshBtn" class="refresh-btn">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.5 8C13.5 9.15761 13.0589 10.2723 12.2588 11.1173C11.4587 11.9623 10.3546 12.4777 9.175 12.5629C7.99545 12.6481 6.82293 12.2965 5.88873 11.5751C4.95454 10.8538 4.325 9.8125 4.125 8.66667M4.125 8.66667L5.5 10M4.125 8.66667L2.75 7.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2.5 8C2.5 6.84239 2.94107 5.7277 3.74118 4.88269C4.54129 4.03768 5.64536 3.52233 6.82491 3.43712C8.00445 3.35191 9.17697 3.70346 10.1112 4.42485C11.0454 5.14625 11.675 6.1875 11.875 7.33333M11.875 7.33333L10.5 6M11.875 7.33333L13.25 8.66667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Refresh Alerts
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <div id="updateNotice"></div>

    <main class="feed">
      <div id="feed" class="articles-list">
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>Loading latest alerts...</p>
        </div>
      </div>
    </main>
  </div>

  <footer>
    <div class="container">
      <div class="footer-content">
        <p>Copyright &copy; <span id="currentYear"></span> - Gratech Co</p>
        <p>US Coast Guard alerts provided via public RSS feed</p>
      </div>
    </div>
  </footer>

  <script>
    // Simple cache implementation
    const RSS_CACHE_KEY = 'uscg_rss_cache';
    const CACHE_DURATION = 15 * 60 * 1000; // 15 minutes

    // DOM elements
    let refreshBtn, lastUpdatedEl, updateNoticeEl, feedEl;

    // Set current year in footer
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    async function loadRSS(showCachedFirst = true) {
      initializeDOMElements();
      
      // Show loading state only on initial load
      if (showCachedFirst) {
        showLoadingState();
      }
      
      // Check cache first and display immediately (progressive loading)
      const cached = getCachedRSS();
      if (cached && showCachedFirst) {
        displayArticles(cached.articles);
        updateLastUpdatedDisplay(cached.timestamp);
      }
      
      // Always try to fetch fresh data in background
      try {
        const feedUrl = 'https://public.govdelivery.com/topics/USDHSCG_428/feed.rss';
        const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`;

        const response = await fetch(apiUrl);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (!data.items || !Array.isArray(data.items)) {
          throw new Error('Invalid RSS data format');
        }
        
        const articles = [];
        
        // Get all items instead of just 8
        data.items.forEach(item => {
          let pubDate = 'Date not available';
          if (item.pubDate) {
            const parsedDate = new Date(item.pubDate);
            if (!isNaN(parsedDate)) {
              pubDate = parsedDate.toLocaleDateString('en-US', {
                year: 'numeric', month: 'short', day: 'numeric',
                hour: '2-digit', minute: '2-digit'
              });
            }
          }
          
          // Keep HTML formatting but clean up potentially harmful elements
          let description = item.description || '';
          // Basic sanitization - remove script tags and style tags
          description = description.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
          description = description.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi, '');
          description = description.replace(/on\w+="[^"]*"/g, '');
          description = description.replace(/on\w+='[^']*'/g, '');
          
          // Add line breaks and formatting for better readability
          description = description
            .replace(/<br\s*\/?>/gi, '\n')
            .replace(/<\/p>/gi, '</p>\n')
            .replace(/<\/div>/gi, '</div>\n');
          
          articles.push({
            title: item.title,
            link: item.link,
            description: description,
            formattedDate: pubDate
          });
        });
        
        // Cache the results with current timestamp
        const cacheData = {
          articles: articles,
          timestamp: Date.now()
        };
        cacheRSS(cacheData);
        
        // Update display with fresh data
        displayArticles(articles);
        updateLastUpdatedDisplay(cacheData.timestamp);
        
        // Show update notice if this was a manual refresh
        if (!showCachedFirst) {
          showUpdateNotice('Alerts updated successfully!', 'success');
        }
        
      } catch (error) {
        console.error('RSS load error:', error);
        
        // If fetch fails and we have no cached data, show error
        if (!cached && showCachedFirst) {
          showErrorState('Failed to load articles. Please try again later.');
        }
        // If we have cached data but background refresh failed, keep showing cached data silently
        else if (cached && showCachedFirst) {
          // Don't show error - just keep cached content visible
          console.log('Background refresh failed, using cached data');
        }
        // If manual refresh fails, show error notice
        else if (!showCachedFirst) {
          showUpdateNotice('Failed to update alerts. Using cached data.', 'error');
          // Make sure we still show the cached data after failed refresh
          const currentCached = getCachedRSS();
          if (currentCached) {
            displayArticles(currentCached.articles);
            updateLastUpdatedDisplay(currentCached.timestamp);
          }
        }
      } finally {
        // Re-enable refresh button if it was disabled
        if (refreshBtn) {
          refreshBtn.disabled = false;
          refreshBtn.classList.remove('loading');
          refreshBtn.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13.5 8C13.5 9.15761 13.0589 10.2723 12.2588 11.1173C11.4587 11.9623 10.3546 12.4777 9.175 12.5629C7.99545 12.6481 6.82293 12.2965 5.88873 11.5751C4.95454 10.8538 4.325 9.8125 4.125 8.66667M4.125 8.66667L5.5 10M4.125 8.66667L2.75 7.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2.5 8C2.5 6.84239 2.94107 5.7277 3.74118 4.88269C4.54129 4.03768 5.64536 3.52233 6.82491 3.43712C8.00445 3.35191 9.17697 3.70346 10.1112 4.42485C11.0454 5.14625 11.675 6.1875 11.875 7.33333M11.875 7.33333L10.5 6M11.875 7.33333L13.25 8.66667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Refresh Alerts
          `;
        }
      }
    }

    function initializeDOMElements() {
      if (!refreshBtn) refreshBtn = document.getElementById('refreshBtn');
      if (!lastUpdatedEl) lastUpdatedEl = document.getElementById('lastUpdated');
      if (!updateNoticeEl) updateNoticeEl = document.getElementById('updateNotice');
      if (!feedEl) feedEl = document.getElementById('feed');
    }

    function showLoadingState() {
      if (!feedEl) return;
      feedEl.innerHTML = `
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>Loading latest alerts...</p>
        </div>
      `;
    }

    function showErrorState(message) {
      if (!feedEl) return;
      feedEl.innerHTML = `
        <div class="error-state">
          <div class="error-icon">??</div>
          <p>${message}</p>
          <button id="retryBtn" class="refresh-btn" style="margin-top: 1rem;">
            Try Again
          </button>
        </div>
      `;
      
      // Add event listener to retry button
      const retryBtn = document.getElementById('retryBtn');
      if (retryBtn) {
        retryBtn.addEventListener('click', () => {
          loadRSS(false);
        });
      }
    }

    function displayArticles(articles) {
      if (!feedEl) return;
      
      if (!articles || articles.length === 0) {
        feedEl.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">??</div>
            <p>No alerts available at this time.</p>
          </div>
        `;
        return;
      }
      
      const articlesHTML = articles.map(item => `
        <div class="article-compact">
          <div class="article-header">
            <h2 class="article-title">
              <a href="${item.link}" target="_blank" rel="noopener">${item.title}</a>
            </h2>
            <div class="article-date">${item.formattedDate}</div>
          </div>
          <div class="article-description">${item.description}</div>
        </div>
      `).join('');
      
      feedEl.innerHTML = articlesHTML;
    }

    function updateLastUpdatedDisplay(timestamp) {
      if (!lastUpdatedEl) return;
      
      if (timestamp) {
        const date = new Date(timestamp);
        const timeString = date.toLocaleTimeString('en-US', {
          hour: 'numeric',
          minute: '2-digit',
          hour12: true
        });
        const dateString = date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });
        lastUpdatedEl.innerHTML = `Last updated: ${dateString} at ${timeString}`;
      } else {
        lastUpdatedEl.innerHTML = 'Last updated: Unknown';
      }
    }

    function showUpdateNotice(message, type = 'success') {
      if (!updateNoticeEl) return;
      
      updateNoticeEl.innerHTML = `
        <div class="update-notice ${type}">
          ${message}
        </div>
      `;
      
      // Clear notice after 5 seconds
      setTimeout(() => {
        if (updateNoticeEl) {
          updateNoticeEl.innerHTML = '';
        }
      }, 5000);
    }

    function getCachedRSS() {
      try {
        const cached = localStorage.getItem(RSS_CACHE_KEY);
        if (!cached) return null;
        
        const cacheData = JSON.parse(cached);
        
        // Check if cache is still valid
        if (Date.now() - cacheData.timestamp > CACHE_DURATION) {
          console.log('Cache expired');
          return null;
        }
        
        return cacheData;
      } catch (e) {
        // If cache is corrupted, ignore it
        console.error('Cache error:', e);
        return null;
      }
    }

    function cacheRSS(cacheData) {
      try {
        localStorage.setItem(RSS_CACHE_KEY, JSON.stringify(cacheData));
      } catch (e) {
        // Ignore cache errors
        console.error('Cache save error:', e);
      }
    }

    function setupRefreshButton() {
      refreshBtn = document.getElementById('refreshBtn');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
          // Disable button and show loading state
          refreshBtn.disabled = true;
          refreshBtn.classList.add('loading');
          refreshBtn.textContent = 'Refreshing...';
          
          // Load fresh data without showing cached first
          loadRSS(false);
        });
      }
    }

    // Load RSS after page loads
    document.addEventListener('DOMContentLoaded', function() {
      initializeDOMElements();
      setupRefreshButton();
      setTimeout(() => loadRSS(true), 100);
    });
  </script>
</body>
</html>